!function(x){x.jgrid.extend({searchGrid:function(m){return m=x.extend({recreateFilter:!1,drag:!0,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:!0,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:!1,closeAfterReset:!1,closeOnEscape:!1,multipleSearch:!1,cloneSearchRowOnAdd:!0,sopt:null,stringResult:void 0,onClose:null,useDataProxy:!1,overlay:!0},x.jgrid.search,m||{}),this.each(function(){var a=this;if(a.grid){var s="fbox_"+a.p.id,e=!0;if(x.fn.searchFilter)if(!0===m.recreateFilter&&x("#"+s).remove(),null!=x("#"+s).html())!1!==(e=x.isFunction(m.beforeShowSearch)&&void 0===(e=m.beforeShowSearch(x("#"+s)))?!0:e)&&(i(),x.isFunction(m.afterShowSearch)&&m.afterShowSearch(x("#"+s)));else{var o,h,p,c=[],u=x("#"+a.p.id).jqGrid("getGridParam","colNames"),t=x("#"+a.p.id).jqGrid("getGridParam","colModel"),f=["eq","ne","lt","le","gt","ge","bw","bn","in","ni","ew","en","cn","nc"],r=[];if(null!==m.sopt)for(o=p=0;o<m.sopt.length;o++)-1!=(h=x.inArray(m.sopt[o],f))&&(r[p]={op:m.sopt[o],text:m.odata[h].text},p++);else for(o=0;o<f.length;o++)r[o]={op:f[o],text:m.odata[o].text};if(x.each(t,function(e,t){var r,i=void 0===t.search||t.search,a=!0===t.hidden,s=x.extend({},{text:u[e],itemval:t.index||t.name},this.searchoptions),t=!0===s.searchhidden;if(void 0!==s.sopt&&(p=0,s.ops=[],0<s.sopt.length))for(o=0;o<s.sopt.length;o++)-1!=(h=x.inArray(s.sopt[o],f))&&(s.ops[p]={op:s.sopt[o],text:m.odata[h].text},p++);if((void 0===this.stype&&(this.stype="text"),"select"==this.stype)&&(void 0===s.dataUrl&&(s.value?r=s.value:this.editoptions&&(r=this.editoptions.value),r)))if(s.dataValues=[],"string"==typeof r){var l,n=r.split(";");for(o=0;o<n.length;o++)l=n[o].split(":"),s.dataValues[o]={value:l[0],text:l[1]}}else if("object"==typeof r)for(var d in o=0,r)r.hasOwnProperty(d)&&(s.dataValues[o]={value:d,text:r[d]},o++);(t&&i||i&&!a)&&c.push(s)}),0<c.length){if(x("<div id='"+s+"' role='dialog' tabindex='-1'></div>").insertBefore("#gview_"+a.p.id),void 0===m.stringResult&&(m.stringResult=m.multipleSearch),a.SearchFilter=x("#"+s).searchFilter(c,{groupOps:m.groupOps,operators:r,onClose:l,resetText:m.Reset,searchText:m.Find,windowTitle:m.caption,rulesText:m.rulesText,matchText:m.matchText,onSearch:function(e){var t=void 0!==e,r=x("#"+a.p.id),i={};!1===m.multipleSearch?(i[m.sField]=e.rules[0].field,i[m.sValue]=e.rules[0].data,i[m.sOper]=e.rules[0].op,i.hasOwnProperty(m.sFilter)&&delete i[m.sFilter]):(i[m.sFilter]=e,x.each([m.sField,m.sValue,m.sOper],function(e,t){i.hasOwnProperty(t)&&delete i[t]})),r[0].p.search=t,x.extend(r[0].p.postData,i),r.trigger("reloadGrid",[{page:1}]),m.closeAfterSearch&&l(x("#"+s))},onReset:function(e){var t=!e||!e.hasOwnProperty("reload")||e.reload,r=x("#"+a.p.id),e={};(r[0].p.search=!1)===m.multipleSearch?e[m.sField]=e[m.sValue]=e[m.sOper]="":e[m.sFilter]="",x.extend(r[0].p.postData,e),t&&r.trigger("reloadGrid",[{page:1}]),m.closeAfterReset&&l(x("#"+s))},stringResult:m.stringResult,ajaxSelectOptions:x.extend({},x.jgrid.ajaxOptions,a.p.ajaxSelectOptions||{}),clone:m.cloneSearchRowOnAdd}),x(".ui-widget-overlay","#"+s).remove(),"rtl"==a.p.direction&&x(".ui-closer","#"+s).css("float","left"),!0===m.drag)if(x("#"+s+" table thead tr:first td:first").css("cursor","move"),jQuery.fn.jqDrag)x("#"+s).jqDrag(x("#"+s+" table thead tr:first td:first"));else try{x("#"+s).draggable({handle:x("#"+s+" table thead tr:first td:first")})}catch(e){}!1===m.multipleSearch&&(x(".ui-del, .ui-add, .ui-del, .ui-add-last, .matchText, .rulesText","#"+s).hide(),x("select[name='groupOp']","#"+s).hide()),!0===m.multipleSearch&&!0===m.loadDefaults&&function(e,t){var r=e.p.postData[t.sFilter];if((r="string"==typeof r?x.jgrid.parse(r):r)&&(r.groupOp&&e.SearchFilter.setGroupOp(r.groupOp),r.rules))for(var i,a=0,s=r.rules.length;a<s;a++)void 0!==(i=r.rules[a]).field&&void 0!==i.op&&void 0!==i.data&&e.SearchFilter.setFilter({sfref:e.SearchFilter.$.find(".sf:last"),filter:x.extend({},i)})&&e.SearchFilter.add()}(a,m),x.isFunction(m.onInitializeSearch)&&m.onInitializeSearch(x("#"+s)),!1!==(e=x.isFunction(m.beforeShowSearch)&&void 0===(e=m.beforeShowSearch(x("#"+s)))?!0:e)&&(i(),x.isFunction(m.afterShowSearch)&&m.afterShowSearch(x("#"+s)),!0===m.closeOnEscape&&x("#"+s).keydown(function(e){27==e.which&&l(x("#"+s)),13==e.which&&x(".ui-search",this).click()}))}}}function l(e){if(m.onClose){var t=m.onClose(e);if("boolean"==typeof t&&!t)return}e.hide(),!0===m.overlay&&x(".jqgrid-overlay:first","#gbox_"+a.p.id).hide()}function i(){var e,t=x(".ui-searchFilter").length;1<t&&(e=x("#"+s).css("zIndex"),x("#"+s).css({zIndex:parseInt(e,10)+t})),x("#"+s).show(),!0===m.overlay&&x(".jqgrid-overlay:first","#gbox_"+a.p.id).show();try{x(":input:visible","#"+s)[0].focus()}catch(e){}}})},updateGridRows:function(e,n,d){var o,h,p=!1;return this.each(function(){var r,i,a,s,l=this;if(!l.grid)return!1;n=n||"id",e&&0<e.length&&x(e).each(function(e){if(a=this,i=l.rows.namedItem(a[n])){if(s=a[n],!0===d&&!0===l.p.jsonReader.repeatitems){l.p.jsonReader.cell&&(a=a[l.p.jsonReader.cell]);for(var t=0;t<a.length;t++)r=l.formatter(s,a[t],t,a,"edit"),h=l.p.colModel[t].title?{title:x.jgrid.stripHtml(r)}:{},(!0===l.p.treeGrid&&o==l.p.ExpandColumn?x("td:eq("+t+") > span:first",i):x("td:eq("+t+")",i)).html(r).attr(h);return p=!0}x(l.p.colModel).each(function(e){o=!0===d&&this.jsonmap||this.name,void 0!==a[o]&&(r=l.formatter(s,a[o],e,a,"edit"),h=this.title?{title:x.jgrid.stripHtml(r)}:{},(!0===l.p.treeGrid&&o==l.p.ExpandColumn?x("td:eq("+e+") > span:first",i):x("td:eq("+e+")",i)).html(r).attr(h),p=!0)})}})}),p},filterGrid:function(l,n){return n=x.extend({gridModel:!1,gridNames:!1,gridToolbar:!1,filterModel:[],formtype:"horizontal",autosearch:!0,formclass:"filterform",tableclass:"filtertable",buttonclass:"filterbutton",searchButton:"Search",clearButton:"Clear",enableSearch:!1,enableClear:!1,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,url:"",marksearched:!0},n||{}),this.each(function(){var i,a,s,p,e,t,c,r,u,f,m,g,v=this;this.p=n,0!==this.p.filterModel.length||!1!==this.p.gridModel?l?(this.p.gridid=-1!=l.indexOf("#")?l:"#"+l,(i=x(this.p.gridid).jqGrid("getGridParam","colModel"))?(!0===this.p.gridModel?(a=x(this.p.gridid)[0],x.each(i,function(e,t){var r=[];this.search=!1!==this.search,s=!(!this.editrules||!0!==this.editrules.searchhidden)||!0!==this.hidden,!0===this.search&&!0===s&&(!0===v.p.gridNames?r.label=a.p.colNames[e]:r.label="",r.name=this.name,r.index=this.index||this.name,r.stype=this.edittype||"text","select"!=r.stype&&(r.stype="text"),r.defval=this.defval||"",r.surl=this.surl||"",r.sopt=this.editoptions||{},r.width=this.width,v.p.filterModel.push(r))})):x.each(v.p.filterModel,function(e,t){for(var r=0;r<i.length;r++)if(this.name==i[r].name){this.index=i[r].index||this.name;break}this.index||(this.index=this.name)}),p=function(){var r,i,a={},s=0,l=x(v.p.gridid)[0];l.p.searchdata={},x.isFunction(v.p.beforeSearch)&&v.p.beforeSearch(),x.each(v.p.filterModel,function(e,t){if(i=this.index,"select"===this.stype)if(r=x("select[name="+i+"]",v).val())a[i]=r,v.p.marksearched&&x("#jqgh_"+this.name,l.grid.hDiv).addClass("dirty-cell"),s++;else{v.p.marksearched&&x("#jqgh_"+this.name,l.grid.hDiv).removeClass("dirty-cell");try{delete l.p.postData[this.index]}catch(e){}}else if(r=x("input[name="+i+"]",v).val())a[i]=r,v.p.marksearched&&x("#jqgh_"+this.name,l.grid.hDiv).addClass("dirty-cell"),s++;else{v.p.marksearched&&x("#jqgh_"+this.name,l.grid.hDiv).removeClass("dirty-cell");try{delete l.p.postData[this.index]}catch(e){}}});var e,t=0<s;x.extend(l.p.postData,a),v.p.url&&(e=x(l).jqGrid("getGridParam","url"),x(l).jqGrid("setGridParam",{url:v.p.url})),x(l).jqGrid("setGridParam",{search:t}).trigger("reloadGrid",[{page:1}]),e&&x(l).jqGrid("setGridParam",{url:e}),x.isFunction(v.p.afterSearch)&&v.p.afterSearch()},e=function(){var i,a,s={},l=0,n=x(v.p.gridid)[0];x.isFunction(v.p.beforeClear)&&v.p.beforeClear(),x.each(v.p.filterModel,function(e,t){switch(a=this.index,i=this.defval||"",this.stype||(this.stype="text"),this.stype){case"select":var r;if(x("select[name="+a+"] option",v).each(function(e){if(0===e&&(this.selected=!0),x(this).text()==i)return this.selected=!0,r=x(this).val(),!1}),r)s[a]=r,v.p.marksearched&&x("#jqgh_"+this.name,n.grid.hDiv).addClass("dirty-cell"),l++;else{v.p.marksearched&&x("#jqgh_"+this.name,n.grid.hDiv).removeClass("dirty-cell");try{delete n.p.postData[this.index]}catch(e){}}break;case"text":if(x("input[name="+a+"]",v).val(i),i)s[a]=i,v.p.marksearched&&x("#jqgh_"+this.name,n.grid.hDiv).addClass("dirty-cell"),l++;else{v.p.marksearched&&x("#jqgh_"+this.name,n.grid.hDiv).removeClass("dirty-cell");try{delete n.p.postData[this.index]}catch(e){}}}});var e,t=0<l;x.extend(n.p.postData,s),v.p.url&&(e=x(n).jqGrid("getGridParam","url"),x(n).jqGrid("setGridParam",{url:v.p.url})),x(n).jqGrid("setGridParam",{search:t}).trigger("reloadGrid",[{page:1}]),e&&x(n).jqGrid("setGridParam",{url:e}),x.isFunction(v.p.afterClear)&&v.p.afterClear()},t=x("<form name='SearchForm' style=display:inline;' class='"+this.p.formclass+"'></form>"),g=x("<table class='"+this.p.tableclass+"' cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),x(t).append(g),m=document.createElement("tr"),"horizontal"==v.p.formtype&&x(g).append(m),x.each(v.p.filterModel,function(e,t){u=document.createElement("td"),x(u).append("<label for='"+this.name+"'>"+this.label+"</label>"),f=document.createElement("td");var r=this;switch(this.stype||(this.stype="text"),this.stype){case"select":if(this.surl)x(f).load(this.surl,function(){r.defval&&x("select",this).val(r.defval),x("select",this).attr({name:r.index||r.name,id:"sg_"+r.name}),r.sopt&&x("select",this).attr(r.sopt),!0===v.p.gridToolbar&&r.width&&x("select",this).width(r.width),!0===v.p.autosearch&&x("select",this).change(function(e){return p(),!1})});else if(r.sopt.value){var i,a,s=r.sopt.value,l=document.createElement("select");if(x(l).attr({name:r.index||r.name,id:"sg_"+r.name}).attr(r.sopt),"string"==typeof s)for(var n=s.split(";"),d=0;d<n.length;d++)i=n[d].split(":"),(a=document.createElement("option")).value=i[0],a.innerHTML=i[1],i[1]==r.defval&&(a.selected="selected"),l.appendChild(a);else if("object"==typeof s)for(var o in s)s.hasOwnProperty(o)&&((a=document.createElement("option")).value=o,a.innerHTML=s[o],s[o]==r.defval&&(a.selected="selected"),l.appendChild(a));!0===v.p.gridToolbar&&r.width&&x(l).width(r.width),x(f).append(l),!0===v.p.autosearch&&x(l).change(function(e){return p(),!1})}break;case"text":var h=this.defval||"";x(f).append("<input type='text' name='"+(this.index||this.name)+"' id='sg_"+this.name+"' value='"+h+"'/>"),r.sopt&&x("input",f).attr(r.sopt),!0===v.p.gridToolbar&&r.width&&(x.browser.msie?x("input",f).width(r.width-4):x("input",f).width(r.width-2)),!0===v.p.autosearch&&x("input",f).keypress(function(e){return 13==(e.charCode||e.keyCode||0)?(p(),!1):this})}"horizontal"==v.p.formtype?((!0===v.p.gridToolbar&&!1===v.p.gridNames?x(m):x(m).append(u)).append(f),x(m).append(f)):(c=document.createElement("tr"),x(c).append(u).append(f),x(g).append(c))}),f=document.createElement("td"),!0===v.p.enableSearch&&(r="<input type='button' id='sButton' class='"+v.p.buttonclass+"' value='"+v.p.searchButton+"'/>",x(f).append(r),x("input#sButton",f).click(function(){return p(),!1})),!0===v.p.enableClear&&(r="<input type='button' id='cButton' class='"+v.p.buttonclass+"' value='"+v.p.clearButton+"'/>",x(f).append(r),x("input#cButton",f).click(function(){return e(),!1})),!0!==v.p.enableClear&&!0!==v.p.enableSearch||("horizontal"==v.p.formtype?x(m).append(f):(c=document.createElement("tr"),x(c).append("<td>&#160;</td>").append(f),x(g).append(c))),x(this).append(t),this.triggerSearch=p,this.clearSearch=e):alert("Could not get grid colModel")):alert("No target grid is set!"):alert("No filter is set")})}})}(jQuery);